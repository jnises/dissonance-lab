- [x] Multi-touch and piano GUI refactor: supports multiple pointers, separates state/rendering, uses `wmidi::Note`/`Semitone`, debug assertions, interval display compatible.
- [x] Shift key as sustain pedal: GUI/synth support, improved sustain logic, visual indicator.
- [x] Dark mode enforced.
- [x] Piano GUI: distinct colors for pressed, sustained, and external keys.
- [x] Extended synth sustain (slower decay).
- [x] Piano types in `piano_types.rs`: shared types for modularity.
- [x] Piano logic in `PianoState`: handles key state, sustain, actions; GUI delegates logic; unit tested.
- [x] Tests for GUI/MIDI input, sustain pedal, key/sustain interactions.
- [x] External MIDI notes octave-normalized in GUI; added tests and Semitone constants.
- [x] Combined shift and MIDI sustain for synth pedal; order-independent; tested.
- [x] Sustain pedal polarity toggle for MIDI controllers; user-toggleable, persists in local storage.
- [x] Removed agent-generated change-description comments from codebase.
- [x] Replaced most `#[allow(...)]` with `#[expect(...)]`; kept `#[allow(dead_code)]` for public API constants.
- [x] Reverb tests: impulse response, wet/dry, room size, damping, clamping, stability, initialization bug fixed.
- [x] Piano string inharmonicity modeled:
  - Inharmonicity coefficient (B) calculated from string properties.
  - Harmonics use inharmonic partials; phase handled per partial.
  - Realistic string parameters for keys; validated against literature (Järveläinen et al.).
  - Bass strings have higher inharmonicity; progressive sharpening of higher partials.
  - Validation tests ensure coefficients and scaling are realistic.
- [x] Calculate dissonances using critical bands theory (plomp levelt) instead.
    - [x] Research Plomp & Levelt's critical bands theory and collect mathematical formulas/parameters
    - [x] Design octave normalization strategy: determine how to handle single-octave display with multi-octave calculations
    - [x] Investigate root note dependency: research whether critical bands theory requires knowledge of chord root
    - [x] Create prototype implementation for interval dissonance using critical bands. Prototype in tmp/
    - [x] Extend implementation to support chord dissonance calculations
    - [x] Compare results with current hardcoded system and validate against known examples. analysis in tmp/validation-analysis.md
    - [x] Replace current dissonance system with critical bands implementation
    - This would allow us to calculate the dissonance of entire chords
    - Research completed: Octave-equivalent critical bands theory implemented. Inversions have identical dissonance. Ready for integration.
    - **COMPLETED**: Replaced hardcoded dissonance with psychoacoustically accurate critical bands implementation. Inversions now correctly show identical dissonance values (e.g., major third = minor sixth). All tests updated and passing.
- [ ] when pressing one or more keys, calculate the dissonance that each other key would result in if pressed in combination with the currently held keys, and show it as a color on the other keys.
- [ ] when only pressing one key, show which interval the other keys would be from the current key if that key is treated as the root. Research in tmp/research-notes.md
- [ ] The dissonance of the currently held notes should show somewhere prominent
- [ ] We only need one row of dissonances that shows what dissonance a new note would result in.
    - for the second note we show the same as we currently do
    - for more notes we show what chord they would result in
- [ ] Make the console output from the audio worklet also forward back to the dev server. perhaps we need to have the audio worklet log using a message instead of straight to console
- [ ] go through the codebase looking for comments that say what has been changed. as is typical of coding agents. remove those as they are not useful longterm
- [ ] Could the midi input callback be moved out of the rust code to make it lower latency?
