- [x] Add multi-touch support and refactor piano_gui.rs
  - Multi-pointer tracking, refactored state/rendering, switched to `wmidi::Note`/`Semitone`, debug assertions, interval display compatibility.
- [x] Make `shift` act as a sustain pedal
  - GUI and synth support for sustain via shift; improved sustain logic and GUI indication.
- [x] Enforce dark mode theme
- [x] Differentiate key states visually in piano_gui
  - Distinct colors for pressed, sustained, and external keys.
- [x] Extend synth sustain duration
  - Reduced decay rate for longer sustain.
- [x] Refactor piano_gui types into `piano_types.rs`
  - Shared types (`Semitone`, `PointerId`, `KeySet`, `ExternalKeySet`) moved for modularity.
- [x] Refactor business logic out of PianoGui into `PianoState`
  - `PianoState` in `piano_state.rs` manages key state, sustain, and actions; GUI delegates logic; comprehensive unit tests.
- [x] Tests for GUI and MIDI input, sustain pedal, and key/sustain interactions
  - Verified correct action generation and GUI state for all input types and sustain scenarios.
- [x] External MIDI notes octave-normalized in GUI
  - MIDI notes from any octave show on correct key; added tests and Semitone constants.
- [x] Combine shift and MIDI sustain sources for synth pedal actions
  - Synth receives pedal on/off only when both sources inactive; order-independent; tested.
- [x] Sustain pedal polarity toggle for MIDI controllers
  - User-toggleable, persists in local storage, fixes inverted pedal behavior.
- [x] Removed agent-generated change-description comments
  - Codebase cleaned of non-useful change logs.
- [x] Replace `#[allow(...)]` with `#[expect(...)]` wherever that makes sense
  - Replaced most `#[allow(dead_code)]` with `#[expect(dead_code)]`; removed attributes where code is actually used; kept `#[allow(dead_code)]` for public API constants provided for convenience
- [x] Write tests to ensure the reverb actually works. Make sure an impulse input results in a sensible output.
  - Added comprehensive reverb tests covering impulse response, wet/dry mixing, room size effects, damping, parameter clamping, stability, and basic functionality. Fixed reverb initialization bug where `update_parameters()` wasn't called during construction.
- [ ] model piano string stiffness inharmonicity
- [ ] Calculate dissonances using critical bands theory (plomp levelt) instead.
    - This would allow us to calculate the dissonance of entire chords
    - how do we handle the fact that we only show a single octave? just force the calculation to happen on a single central octave?
    - can critical bands theory be made octave normalized?
    - does critical bands theory care about the root? do we need to know which note is the root? can the overtones be extended downwards?
- [ ] The dissonance of the currently held notes should show somewhere prominent
- [ ] We only need one row of dissonances that shows what dissonance a new note would result in.
    - for the second note we show the same as we currently do
    - for more notes we show what chord they would result in
- [ ] Make the console output from the audio worklet also forward back to the dev server. perhaps we need to have the audio worklet log using a message instead of straight to console
- [ ] go through the codebase looking for comments that say what has been changed. as is typical of coding agents. remove those as they are not useful longterm
- [ ] Could the midi input callback be moved out of the rust code to make it lower latency?
